(function(e=document.body){e instanceof HTMLElement||(e=document.body);const t=document.createElement("div");t.style.cssText="width: 100%; max-width: 680px;";const n={EASY:{name:"easy",height:8,width:10,mines:10},MID:{name:"mid",height:14,width:18,mines:40},HARD:{name:"hard",height:20,width:24,mines:99}};let a=n.EASY;const s={1:"#1976d2",2:"#388e3c",3:"#d32f2f",4:"#7b1fa2",5:"#ff8f00",6:"#0097a7",flag:"red",mine:"black"},l=document.createElement("div");l.classList.add("toolbar");const o=document.createElement("select");for(const[e,t]of Object.entries(n)){const n=document.createElement("option");n.value=e,n.textContent=t.name,n.selected=e==a.name.toUpperCase(),o.appendChild(n)}l.appendChild(o);const c=document.createElement("span");c.classList.add("mine-counter"),l.appendChild(c);const i=document.createElement("span");i.textContent=0,i.classList.add("time-counter"),l.appendChild(i),t.appendChild(l),e.appendChild(t);let d,{width:r,height:m,mines:h}=a,u=0,p=[],f=!0;return{initGame(){d=setInterval((()=>{u++,i.textContent=u}),1e3),i.onclick=()=>{this.reset()},o.onchange=()=>{this.changeDif(o.value)};const e=document.createElement("div");e.classList.add("grid"),e.oncontextmenu=()=>!1,document.documentElement.style.setProperty("--nbColumns",r),c.textContent=h;for(let t=0;t<m;t++){const n=[];for(let a=0;a<r;a++){let s=document.createElement("div");s.onmousedown=this.clickCallback(t,a),(t+a)%2==0&&s.classList.add("alternate");const l={status:0,marked:!1,unraveled:!1,element:s};e.appendChild(s),n.push(l)}p.push(n)}t.appendChild(e),this.placeMines()},placeMines(){let e=0;for(;e<h;){const t=Math.floor(Math.random()*m),n=Math.floor(Math.random()*r),a=p[t][n];1!==a.status&&(a.status=1,e++)}},clickCallback(e,t){return n=>{if(n.preventDefault(),!f)return;const a=p[e][t];if(!a.unraveled){if(0===n.button){if(a.marked)return;1===a.status?this.lostGame():(a.unraveled=!0,this.unravel(e,t))}else 2===n.button&&(a.marked=!a.marked,a.marked?(a.element.textContent="âš‘",a.element.style.color=s.flag,h--):(a.element.textContent="",a.element.style.color="",h++),c.textContent=h);this.checkWin(),!1===f&&clearInterval(d)}}},unravel(e,t){const n=p[e][t];n.unraveled=!0;let a=0;for(let n=e-1;n<=e+1;n++)for(let s=t-1;s<=t+1;s++)n===e&&s===t||n<0||n>=m||s<0||s>=r||1===p[n][s].status&&a++;if(n.element.classList.add("open"),a>0)n.element.textContent=a,n.element.style.color=s[a];else for(let n=e-1;n<=e+1;n++)for(let a=t-1;a<=t+1;a++)n===e&&a===t||n<0||n>=m||a<0||a>=r||1===p[n][a].status||p[n][a].marked||p[n][a].unraveled||this.unravel(n,a)},lostGame(){for(let e=0;e<p.length;e++)for(let t=0;t<p[e].length;t++){const n=p[e][t];1!==n.status||n.marked?1!==n.status&&n.marked&&(n.element.textContent="x"):n.element.textContent="*"}this.endScreen(!1)},checkWin(){let e=0;for(let t=0;t<p.length;t++)for(let n=0;n<p[t].length;n++){const a=p[t][n];1===a.status&&a.marked||a.unraveled||e++}h===e&&this.endScreen(!0)},changeDif(e){a=n[e],this.reset()},endScreen(e=!1){f=!1,clearInterval(d);const t=localStorage.getItem("pb");e&&(!t||isNaN(parseInt(t))||u<t)&&localStorage.setItem("pb",u),e||(u="");const n=document.createElement("dialog");n.innerHTML=`<div><span>Run: ${u}</span><span>Pb: ${t??"-"}</span></div>`;const a=document.createElement("button");a.innerHTML='<img src="https://www.gstatic.com/images/icons/material/system/2x/refresh_white_24dp.png">Play Again',a.onclick=()=>{n.remove(),this.changeDif(o.value)},n.appendChild(a),document.body.appendChild(n),setTimeout((()=>{n.showModal()}),2500)},reset(){({width:r,height:m,mines:h}=a),t.querySelector(".grid").remove(),p=[],f=!0,u=0,clearInterval(d),i.textContent=0,this.initGame()}}})().initGame();
